<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<title>Insurance Calculator (Auto Currency)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#eef1f5;
  --card:#ffffff;
  --text:#0f172a;
  --header:#111827;
  --header-text:#f9fafb;
  --border:#cbd5e1;
}
body.dark{
  --bg:#020617;
  --card:#0f172a;
  --text:#e5e7eb;
  --header:#000000;
  --header-text:#f9fafb;
  --border:#475569;
}

*{box-sizing:border-box;}

body{
    margin:0;
    font-family:Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
}

header{
    background:var(--header);
    color:var(--header-text);
    padding:10px 16px;
    display:flex;
    align-items:center;
    gap:12px;
}
header .spacer{ flex:1; }

.container{
    max-width:1200px;
    margin:0 auto;
    padding:16px;
    display:flex;
    gap:16px;
    flex-wrap:wrap;
}

.card{
    background:var(--card);
    border-radius:12px;
    border:1px solid var(--border);
    padding:16px;
    box-shadow:0 2px 8px rgba(0,0,0,0.18);
    flex:1 1 360px;
    min-width:320px;
}

h2{ margin:0 0 10px 0; font-size:18px; }
label{
    display:block;
    font-size:12px;
    font-weight:600;
    margin-top:8px;
}

input, select, textarea{
    width:100%;
    padding:8px;
    border-radius:8px;
    border:1px solid var(--border);
    background:var(--card);
    font-size:13px;
}

textarea{
    min-height:130px;
    resize:vertical;
    font-family:Consolas, monospace;
}

button.action{
    width:100%;
    padding:9px;
    margin-top:10px;
    border:none;
    border-radius:8px;
    background:#2563eb;
    color:white;
    font-weight:700;
    cursor:pointer;
    font-size:14px;
}

.row{ display:flex; gap:10px; }
.row > div{ flex:1; }

.value{ font-weight:700; }
.green{ color:#22c55e; }
.red{ color:#ef4444; }
</style>
</head>

<body>

<header>
    <h1>Insurance Calculator (Auto Currency)</h1>
    <div class="spacer"></div>
    <button onclick="document.body.classList.toggle('dark')">üåô / ‚òÄÔ∏è</button>
</header>

<div class="container">

    <!-- SKAIƒåIUOKLƒñ -->
    <div class="card" id="calcCard">
        <h2>Skaiƒçiuoklƒó</h2>

        <label>Invoice valiuta</label>
        <select id="invoiceCurrency">
            <option>USD</option>
            <option>EUR</option>
            <option>PLN</option>
            <option>GBP</option>
            <option>CHF</option>
            <option>TRY</option>
            <option>KZT</option>
            <option>CNY</option>
            <option>CAD</option>
            <option>AUD</option>
        </select>

        <label>Invoice suma (ta valiuta)</label>
        <input type="number" id="invoiceAmount">

        <label>Invoice suma EUR (automati≈°kai per ECB/LB)</label>
        <input type="text" id="invoiceEUR" readonly style="background:#e2e8f0;">

        <div class="row">
            <div>
                <label>Brokerio %</label>
                <select id="brokerPercent">
                    <option value="0.07">0,07 %</option>
                    <option value="0.08">0,08 %</option>
                    <option value="0.10">0,10 %</option>
                    <option value="0.12">0,12 %</option>
                    <option value="custom">Kitas</option>
                </select>
            </div>
            <div>
                <label>Brokerio % (jei Kitas)</label>
                <input type="text" id="brokerCustom" placeholder="pvz. 0.09" disabled>
            </div>
        </div>

        <div class="row">
            <div>
                <label>Tavo % klientui</label>
                <select id="myPercent">
                    <option value="0.23">0,23 %</option>
                    <option value="0.24" selected>0,24 %</option>
                    <option value="0.25">0,25 %</option>
                    <option value="custom">Kitas</option>
                </select>
            </div>
            <div>
                <label>Tavo % (jei Kitas)</label>
                <input type="text" id="myCustom" placeholder="pvz. 0.27" disabled>
            </div>
        </div>

        <button class="action" onclick="calc()">Skaiƒçiuoti</button>

        <h3>Rezultatai</h3>
        <p>Invoice EUR: <span id="resInvoiceEUR" class="value">‚Äì</span></p>
        <p>Savikaina (brokeris): <span id="resCost" class="value">‚Äì</span></p>
        <p>Kaina klientui: <span id="resClient" class="value">‚Äì</span></p>
        <p>Pelnas: <span id="resProfit" class="value">‚Äì</span></p>

        <h4>AON vs Legator</h4>
        <p>AON 0,07 %: <span id="resAON" class="value">‚Äì</span></p>
        <p>Legator 0,10 %: <span id="resLeg" class="value">‚Äì</span></p>
    </div>

    <!-- KLIENTO TEKSTAS -->
    <div class="card" id="clientCard">
        <h2>Tekstas klientui</h2>

        <label>Kursas EUR ‚Üí USD</label>
        <input type="text" id="rateEurUsd" placeholder="pvz. 1.1550">

        <button class="action" onclick="generateClientText()">Generuoti tekstƒÖ</button>

        <label>Tekstas klientui</label>
        <textarea id="clientText"></textarea>
    </div>
</div>

<script>

/* Lietuvi≈°kas kablelis ‚Üí ta≈°kas */
function fixNumber(v){
    if(!v) return null;
    return parseFloat(v.replace(",", "."));
}

/* ECB konvertavimas */
document.getElementById("invoiceAmount").addEventListener("input", autoConvert);
document.getElementById("invoiceCurrency").addEventListener("change", autoConvert);

async function autoConvert(){
    const cur = document.getElementById("invoiceCurrency").value;
    const amt = fixNumber(document.getElementById("invoiceAmount").value);
    const out = document.getElementById("invoiceEUR");

    if(!amt){ out.value=""; return; }

    if(cur==="EUR"){ out.value = amt.toFixed(2); return; }

    try {
        const r = await fetch("https://api.frankfurter.app/latest?from="+cur+"&to=EUR");
        const d = await r.json();
        out.value = (amt * d.rates.EUR).toFixed(4);
    } catch(e){
        out.value = "";
    }
}

/* "Kitas" rankinio aktyvacija */
document.getElementById("brokerPercent").addEventListener("change", function(){
    document.getElementById("brokerCustom").disabled = this.value !== "custom";
});
document.getElementById("myPercent").addEventListener("change", function(){
    document.getElementById("myCustom").disabled = this.value !== "custom";
});

/* SKAIƒåIAVIMAS */
function calc(){
    const eur = fixNumber(document.getElementById("invoiceEUR").value);
    if(!eur){ alert("Neteisingas EUR"); return; }

    let b = document.getElementById("brokerPercent").value;
    b = (b==="custom") 
        ? fixNumber(document.getElementById("brokerCustom").value)/100
        : parseFloat(b)/100;

    let m = document.getElementById("myPercent").value;
    m = (m==="custom") 
        ? fixNumber(document.getElementById("myCustom").value)/100
        : parseFloat(m)/100;

    const cost = eur * b;
    const client = eur * m;
    const profit = client - cost;

    document.getElementById("resInvoiceEUR").textContent = eur.toFixed(2)+" EUR";
    document.getElementById("resCost").textContent = cost.toFixed(2)+" EUR";
    document.getElementById("resClient").textContent = client.toFixed(2)+" EUR";

    const pEl = document.getElementById("resProfit");
    pEl.textContent = profit.toFixed(2)+" EUR";
    pEl.className = "value " + (profit>=0 ? "green" : "red");

    document.getElementById("resAON").textContent = (eur*0.0007).toFixed(2)+" EUR";
    document.getElementById("resLeg").textContent = (eur*0.001).toFixed(2)+" EUR";

    window.lastClientEUR = client;
}

/* KLIENTO TEKSTAS */
function generateClientText(){
    const eur = window.lastClientEUR;
    const rate = fixNumber(document.getElementById("rateEurUsd").value);

    if(!eur){ alert("Pirmiau apskaiƒçiuok!"); return; }

    let out = "Insurance price:\n";
    out += eur.toFixed(2)+" EUR\n";

    if(rate){
        out += (eur*rate).toFixed(2)+" USD\n";
    }

    document.getElementById("clientText").value = out;
}

</script>

</body>
</html>
