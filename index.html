<!DOCTYPE html>
<html lang="lt">
<head>
<meta charset="UTF-8">
<title>Insurance Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family:Arial;
  background:#f3f4f6;
}
.container { max-width:1200px; margin:0 auto; padding:20px; display:flex; gap:20px; }
.card {
  background:white; padding:16px; border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15); flex:1; min-width:340px;
}
input,select,textarea {
  width:100%; padding:8px; margin-top:4px;
  border-radius:8px; border:1px solid #ccc;
}
button {
  width:100%; padding:10px;
  background:#2563eb; color:white; border:none;
  border-radius:8px; margin-top:12px; cursor:pointer;
  font-weight:700;
}
button:hover { background:#1d4ed8; }
.result { font-weight:bold; }
</style>
</head>

<body>

<div class="container">

  <!-- SKAIČIUOKLĖ -->
  <div class="card">

    <h2>Skaičiuoklė</h2>

    <label>Invoice valiuta</label>
    <select id="invoiceCurrency">
      <option>USD</option><option>EUR</option><option>PLN</option><option>GBP</option>
      <option>CHF</option><option>TRY</option><option>KZT</option><option>CNY</option>
      <option>CAD</option><option>AUD</option><option>NOK</option><option>SEK</option><option>JPY</option>
    </select>

    <label>Invoice suma (ta valiuta)</label>
    <input id="invoiceAmount" type="number" placeholder="pvz. 625000">

    <label>Invoice suma EUR (automatiškai per ECB)</label>
    <input id="invoiceEUR" readonly style="background:#e5e7eb;">

    <label>Brokerio %</label>
    <select id="brokerPercent">
      <option value="0.07">0,07 %</option>
      <option value="0.10">0,10 %</option>
      <option value="0.12">0,12 %</option>
      <option value="custom">Kitas</option>
    </select>

    <input id="brokerCustom" placeholder="pvz. 0.09" disabled>

    <label>Tavo % klientui</label>
    <select id="myPercent">
      <option value="0.23">0,23 %</option>
      <option value="0.24" selected>0,24 %</option>
      <option value="0.25">0,25 %</option>
      <option value="custom">Kitas</option>
    </select>

    <input id="myCustom" placeholder="pvz. 0.27" disabled>

    <button onclick="calc()">Skaičiuoti</button>

    <h3>Rezultatai</h3>
    <p>Invoice EUR: <span id="resInvoiceEUR" class="result">–</span></p>
    <p>Savikaina (brokeris): <span id="resCost" class="result">–</span></p>
    <p>Kaina klientui: <span id="resClient" class="result">–</span></p>
    <p>Pelnas: <span id="resProfit" class="result">–</span></p>

  </div>

  <!-- KLIENTO TEKSTAS -->
  <div class="card">

    <h2>Tekstas klientui</h2>

    <label>Kalba</label>
    <select id="lang">
      <option value="LT">Lietuvių</option>
      <option value="EN">English</option>
      <option value="RU">Русский</option>
    </select>

    <label>Pasirink papildomą valiutą</label>
    <select id="extraCurrency">
      <option>USD</option><option>GBP</option><option>PLN</option>
      <option>CHF</option><option>CNY</option><option>CAD</option>
      <option>AUD</option><option>NOK</option><option>SEK</option><option>JPY</option>
    </select>

    <button onclick="generateClientText()">Generuoti tekstą klientui</button>

    <textarea id="clientText" style="min-height:180px;"></textarea>

    <button onclick="copyClientText()">Kopijuoti tekstą</button>

  </div>

</div>

<script>
// AUTO CLEAR
function clearResults() {
  document.getElementById("resInvoiceEUR").textContent = "–";
  document.getElementById("resCost").textContent = "–";
  document.getElementById("resClient").textContent = "–";
  document.getElementById("resProfit").textContent = "–";
  document.getElementById("clientText").value = "";
}

// ECB auto-convert
document.getElementById("invoiceCurrency").addEventListener("change", autoConvert);
document.getElementById("invoiceAmount").addEventListener("input", autoConvert);

async function autoConvert() {
  clearResults();
  let cur = invoiceCurrency.value;
  let amt = parseFloat(invoiceAmount.value);
  if (!amt) { invoiceEUR.value = ""; return; }
  if (cur === "EUR") { invoiceEUR.value = amt.toFixed(2); return; }
  try {
    let r = await fetch(`https://api.frankfurter.app/latest?from=${cur}&to=EUR`);
    let d = await r.json();
    invoiceEUR.value = (amt * d.rates.EUR).toFixed(2);
  } catch {
    invoiceEUR.value = "";
  }
}

// percent custom toggle
brokerPercent.onchange = () => brokerCustom.disabled = brokerPercent.value !== "custom";
myPercent.onchange = () => myCustom.disabled = myPercent.value !== "custom";

let lastEUR = null;

function calc() {
  clearResults();

  const eur = parseFloat(invoiceEUR.value);
  if (!eur) { alert("Pirmiausia konvertuok invoice sumą"); return; }

  let b = brokerPercent.value === "custom" ? parseFloat(brokerCustom.value)/100 : parseFloat(brokerPercent.value)/100;
  let m = myPercent.value === "custom" ? parseFloat(myCustom.value)/100 : parseFloat(myPercent.value)/100;

  const cost = eur * b;
  const client = eur * m;
  const profit = client - cost;

  lastEUR = client;

  resInvoiceEUR.textContent = eur.toFixed(2) + " EUR";
  resCost.textContent = cost.toFixed(2) + " EUR";
  resClient.textContent = client.toFixed(2) + " EUR";
  resProfit.textContent = profit.toFixed(2) + " EUR";
}

async function generateClientText() {
  clearResults();

  if (!lastEUR) { alert("Pirmiausia apskaičiuok"); return; }

  let eurValue = lastEUR;
  let cur = extraCurrency.value;

  let rate = 0;
  try {
    let r = await fetch(`https://api.frankfurter.app/latest?from=EUR&to=${cur}`);
    let d = await r.json();
    rate = d.rates[cur];
  } catch {
    rate = 0;
  }

  let converted = eurValue * rate;
  let date = new Date().toISOString().split("T")[0];

  let txt = "";

  if (lang.value === "LT") {
    txt =
`Siunčiame preliminarią draudimo įmokos kainą pagal pateiktą invoice vertę.

• Draudimo kaina: ${eurValue.toFixed(2)} EUR
• Suma ${cur} pagal šiandienos kursą: ${converted.toFixed(2)} ${cur}
• Invoice vertė: ${invoiceAmount.value} ${invoiceCurrency.value}
• Data: ${date}

Pastaba:
Tai orientacinė įmoka, paskaičiuota pagal invoice vertę ir šiandienos valiutos kursą.
Galutinė kaina gali skirtis priklausomai nuo poliso išrašymo dienos.`;
  }

  if (lang.value === "EN") {
    txt =
`Please find below the preliminary insurance premium calculated based on the provided invoice value.

• Insurance price: ${eurValue.toFixed(2)} EUR
• Amount in ${cur} at today’s rate: ${converted.toFixed(2)} ${cur}
• Invoice value: ${invoiceAmount.value} ${invoiceCurrency.value}
• Date: ${date}

Note:
This is an indicative premium based on the invoice value and current exchange rate.
The final amount may vary depending on the policy issuance date.`;
  }

  if (lang.value === "RU") {
    txt =
`Ниже указана предварительная стоимость страховой премии, рассчитанная на основе суммы инвойса.

• Стоимость страховки: ${eurValue.toFixed(2)} EUR
• Сумма в ${cur} по текущему курсу: ${converted.toFixed(2)} ${cur}
• Сумма инвойса: ${invoiceAmount.value} ${invoiceCurrency.value}
• Дата: ${date}

Примечание:
Это ориентировочная премия, рассчитанная по сумме инвойса и текущему курсу.
Фактическая стоимость может отличаться в зависимости от даты оформления полиса.`;
  }

  clientText.value = txt;
}

function copyClientText() {
  clientText.select();
  document.execCommand("copy");
}
</script>

</body>
</html>
